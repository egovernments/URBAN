<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://cdn.jsdelivr.net/npm/@egovernments/digit-ui-css/img/browser-icon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
      type="text/css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#00bcd1" />
    <title>Digit</title>
    <link rel="stylesheet" href="https://unpkg.com/@egovernments/digit-ui-css/dist/index.css" />
    <link rel="stylesheet" href="https://unpkg.com/@egovernments/digit-ui-css@1.6.6/dist/index.css" />

    <script src="https://s3.ap-south-1.amazonaws.com/egov-dev-assets/globalConfigs.js"></script>
    <script src="%REACT_APP_GLOBAL%"></script>

    <!-- Security: Token Cleanup Script - Runs before app loads -->
    <script>
      (function() {
        'use strict';

        // List of forbidden token keys in localStorage
        var forbiddenLocalStorageKeys = [
          'token',
          'Citizen.token',
          'Employee.token',
          'refresh_token',
          'authToken',
          'auth-token'
        ];

        // List of forbidden fields in sessionStorage Digit.User
        var forbiddenUserFields = [
          'refresh_token',
          'token_type',
          'expires_in',
          'scope',
          'ResponseInfo'
        ];

        // Clean localStorage
        function cleanLocalStorage() {
          var cleaned = false;
          forbiddenLocalStorageKeys.forEach(function(key) {
            if (localStorage.getItem(key)) {
              console.warn('[SECURITY] Removing forbidden key from localStorage: "' + key + '"');
              localStorage.removeItem(key);
              cleaned = true;
            }
          });
          return cleaned;
        }

        // Clean sessionStorage Digit.User object
        function cleanSessionStorageUser() {
          try {
            var digitUserRaw = sessionStorage.getItem('Digit.User');
            if (!digitUserRaw) return false;

            var digitUser = JSON.parse(digitUserRaw);
            if (!digitUser || !digitUser.value) return false;

            var cleaned = false;
            forbiddenUserFields.forEach(function(field) {
              if (digitUser.value[field] !== undefined) {
                console.warn('[SECURITY] Removing forbidden field from sessionStorage Digit.User: "' + field + '"');
                delete digitUser.value[field];
                cleaned = true;
              }
            });

            if (cleaned) {
              sessionStorage.setItem('Digit.User', JSON.stringify(digitUser));
            }
            return cleaned;
          } catch (err) {
            console.error('[SECURITY] Error cleaning sessionStorage:', err);
            return false;
          }
        }

        // Run cleanup immediately on page load
        var localCleaned = cleanLocalStorage();
        var sessionCleaned = cleanSessionStorageUser();

        if (localCleaned || sessionCleaned) {
          console.log('[SECURITY] Initial token cleanup completed');
        }

        // Setup continuous monitoring
        setInterval(function() {
          cleanLocalStorage();
          cleanSessionStorageUser();
        }, 5000);

        console.log('[SECURITY] Token cleanup monitor active (index.html)');
      })();
    </script>
  </head>
  <style>
    .options-card {
      overflow: auto;
      max-height: 18em !important;
    }

    .employee-select-wrap .options-card {
      overflow: auto !important;
      max-height: 18em !important;
    }

    .employee-select-wrap .options-card-DateRangePicker {
    overflow: visible !important;
    max-height: 23.75em !important;
  }
  </style>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
